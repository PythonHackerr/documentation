## Features used

- [Android SDK](/sdk/android)
- [Geofences](/geofences)

## Steps

### Step 1: Sign up for Radar

If you haven't already, sign up for Radar to get your API key. You can create up to 1,000 geofences and make up to 100,000 API requests per month for free.

<a className="btn btn-large btn-primary" href="https://radar.com/signup">Get API Keys</a>

### Step 2: Import geofences

On the [Geofences page](https://radar.com/dashboard), import geofences for RadarMart locations.

The CSV should include 8 columns:

- **`description`**: A display name for the geofence. In this case, the store name.
- **`tag`**: A group for the geofence. In this case, `store`.
- **`externalId`**: An external ID for the geofence that maps to your internal database. In this case, the store ID.
- **`type`**: The type of geofence geometry. In this case, `circle`.
- **`radius`**: The radius in meters for type circle. In this case, `100`.
- **`coordinates`**: A JSON string representing a center in the format [longitude,latitude] for type circle. Note that longitude comes before latitude, a GeoJSON convention.
- **`enabled`**: In this case, `true`.
- **`metadata`**: A set of custom key-value pairs for the geofence. A JSON string representing a dictionary with up to 16 keys and values of type string, boolean, or number. In this case, `{"parking": true}` or `{"parking": false}`.

```csv
description,tag,externalId,type,radius,coordinates,enabled,metadata
RadarMart #1,store,1,circle,100,"[-73.986752,40.703919]",true,"{""parking"":true}"
RadarMart #2,store,2,circle,100,"[-73.993156,40.700554]",true,"{""parking"":false}"
RadarMart #3,store,3,circle,100,"[-73.983295,40.697693]",true,"{""parking"":false}"
```

### Step 3: Install the Radar Android SDK

[Install the Radar SDK](/sdk/android).

Initialize the SDK in your `Application` class with your publishable API key.

```kotlin
import io.radar.sdk.Radar

class MyApplication : Application() {

    override fun onCreate() {
        super.onCreate()

        Radar.initialize(this, "prj_test_pk...")
    }

}
```

In the `MainActvity` class implementation a request for foreground location permissions.

```kotlin
import io.radar.sdk.Radar

class MainActivity : AppCompatActivity() {
    private val foregroundLocationPermissionsRequestCode = 0
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        requestLocationPermissions()
    }

    private fun requestLocationPermissions() {
        if (ActivityCompat.checkSelfPermission(this,Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
            if (Build.VERSION.SDK_INT == Build.VERSION_CODES.Q) {
                ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.ACCESS_COARSE_LOCATION,Manifest.permission.ACCESS_FINE_LOCATION), foregroundLocationPermissionsRequestCode)
            }
        }
    }
}
```

### Step 4: Check if the user is in a geofence, then prompt the user to enter in store mode

Call `Radar.trackOnce()` to track the user's location in the foreground. In the callback, check `user.geofences` to determine if the user is in a geofence, then show a message that allows the user to enter in store mode. 

```kotlin
    Radar.trackOnce { status, location, events, user ->
        if (user !=  null) {
            if (user.geofences?.any{ geofence -> geofence.tag == "store" } == true) {
                var storeGeofence = user.geofences?.find { geofence -> geofence.tag == "store" }
                if (storeGeofence != null) {
                    storeGeofence.externalId?.let { showInStoreMode(storeGeofence.description, it) }
                }
            }
        }
    }
```

The `showInStoreMode` method presents a dialog to ask the user to enter in store mode. 

In this example, the in store mode is a separate Activity that is navigated to if the user indicates they want to activate the experience.  As part of the in store mode activity creation, geofence attributes are sent to the activity with the intent to surface the associated store's experience.

```kotlin
    private fun showInStoreMode(storeName: String, storeId: String) {
        val dialogBuilder = AlertDialog.Builder(this)
        dialogBuilder.setMessage("Enter store experience at $storeName")
            .setCancelable(false)
            .setPositiveButton("Activate", DialogInterface.OnClickListener {
                    _, _ ->
                val intent = Intent(applicationContext, InStoreMode::class.java)
                intent.putExtra("storeId", storeId)
                intent.putExtra("storeName", storeName)
                startActivity(intent)
            })
            .setNegativeButton("Cancel", DialogInterface.OnClickListener {
                    dialog, _ -> dialog.cancel()
            })
        val alert = dialogBuilder.create()
        alert.setTitle("In Store Mode Now Available")
        alert.show()
    }
```

Below is the example InStoreMode activity. The store information is captured from the intent and displayed to the customer as part of the in store experience.

```kotlin
class InStoreMode : AppCompatActivity() {
    private lateinit var title: TextView
    private lateinit var subTitle: TextView
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_in_store)
        title = findViewById<View>(R.id.title) as TextView
        subTitle = findViewById<View>(R.id.sub_title) as TextView
        val intent = intent
        val storeName = intent.getStringExtra("storeName")
        val storeId = intent.getStringExtra("storeId")
        title.text = "Welcome to $storeName"
        subTitle.text = "(store $storeId)"
    }
}
```

## Below is full code for the experience

MainApplication

```kotlin

import io.radar.sdk.Radar

class MyApplication : Application() {

    override fun onCreate() {
        super.onCreate()
        Radar.initialize(this, "prj_test_pk...")
    }
}

```

MainActivity

```kotlin

import io.radar.sdk.Radar

class MainActivity : AppCompatActivity() {
    private val foregroundLocationPermissionsRequestCode = 0
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        requestLocationPermissions()

        Radar.trackOnce { status, location, events, user ->
            if (user !=  null) {
                if (user.geofences?.any{ geofence -> geofence.tag == "store" } == true) {
                    var storeGeofence = user.geofences?.find { geofence -> geofence.tag == "store" }
                    if (storeGeofence != null) {
                        storeGeofence.externalId?.let { showInStoreMode(storeGeofence.description, it) }
                    }
                }
            }
        }
    }

    private fun showInStoreMode(storeName: String, storeId: String) {
        val dialogBuilder = AlertDialog.Builder(this)
        dialogBuilder.setMessage("Enter store experience at $storeName")
            .setCancelable(false)
            .setPositiveButton("Activate", DialogInterface.OnClickListener {
                    _, _ ->
                val intent = Intent(applicationContext, InStoreMode::class.java)
                intent.putExtra("storeId", storeId)
                intent.putExtra("storeName", storeName)
                startActivity(intent)
            })
            .setNegativeButton("Cancel", DialogInterface.OnClickListener {
                    dialog, _ -> dialog.cancel()
            })
        val alert = dialogBuilder.create()
        alert.setTitle("In Store Mode Now Available")
        alert.show()
    }

    private fun requestLocationPermissions() {
        if (ActivityCompat.checkSelfPermission(this,Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
            if (Build.VERSION.SDK_INT == Build.VERSION_CODES.Q) {
                ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.ACCESS_COARSE_LOCATION,Manifest.permission.ACCESS_FINE_LOCATION), foregroundLocationPermissionsRequestCode)
            }
        }
    }
}
```

InStoreMode class

```kotlin
class InStoreMode : AppCompatActivity() {
    private lateinit var title: TextView
    private lateinit var subTitle: TextView
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_in_store)
        title = findViewById<View>(R.id.title) as TextView
        subTitle = findViewById<View>(R.id.sub_title) as TextView
        val intent = intent
        val storeName = intent.getStringExtra("storeName")
        val storeId = intent.getStringExtra("storeId")
        title.text = "Welcome to $storeName"
        subTitle.text = "($storeId)"
    }
}
```

## Support

Have questions or feedback on this documentation? Let us know! Email us at [support@radar.com](mailto:support@radar.com).
