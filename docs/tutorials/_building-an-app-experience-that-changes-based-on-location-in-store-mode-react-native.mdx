## Features used

- [React Native SDK](/sdk/react-native)
- [Geofences](/geofences)

## Steps

### Step 1: Sign up for Radar

If you haven't already, sign up for Radar to get your API key. You can create up to 1,000 geofences and make up to 100,000 API requests per month for free.

<a className="btn btn-large btn-primary" href="https://radar.com/signup">Get API Keys</a>

### Step 2: Import geofences

On the [Geofences page](https://radar.com/dashboard), import geofences for RadarMart locations.

The CSV should include 8 columns:

- **`description`**: A display name for the geofence. In this case, the store name.
- **`tag`**: A group for the geofence. In this case, `store`.
- **`externalId`**: An external ID for the geofence that maps to your internal database. In this case, the store ID.
- **`type`**: The type of geofence geometry. In this case, `circle`.
- **`radius`**: The radius in meters for type circle. In this case, `100`.
- **`coordinates`**: A JSON string representing a center in the format [longitude,latitude] for type circle. Note that longitude comes before latitude, a GeoJSON convention.
- **`enabled`**: In this case, `true`.
- **`metadata`**: A set of custom key-value pairs for the geofence. A JSON string representing a dictionary with up to 16 keys and values of type string, boolean, or number. In this case, `{"parking": true}` or `{"parking": false}`.

```csv
description,tag,externalId,type,radius,coordinates,enabled,metadata
RadarMart #1,store,1,circle,100,"[-73.986752,40.703919]",true,"{""parking"":true}"
RadarMart #2,store,2,circle,100,"[-73.993156,40.700554]",true,"{""parking"":false}"
RadarMart #3,store,3,circle,100,"[-73.983295,40.697693]",true,"{""parking"":false}"
```

### Step 3: Install the Radar React Native SDK and React Navigation

[Install the Radar SDK](/sdk/react-native).

Since only foreground tracking is needed, the React Native SDK can be initialized in javascript. Additionally, ensure foreground location permissions are requested. In this tutorial, we will just check for permissions on each home screen render:


```javascript

import Radar from 'react-native-radar';

Radar.initialize("prj_test_pk_...");

export default HomeScreen = () => {
  
    useEffect(() => {
      requestPermissions();
      // other on render logic
    }, []);

    const requestPermissions = () => {
      Radar.getPermissionsStatus().then((status) => {
       if (status === 'NOT_DETERMINED') {
        Radar.requestPermissions(false).then((status) => {
          if (status === 'GRANTED_FOREGROUND') {
            // in store mode check if permissions granted
          }
        });
       }
      }).catch((error) => console.log(error.message)) 
    }
}
```

Additionally, this example will use React Navigation to direct the user to the in store mode. See here for details on installation: https://reactnative.dev/docs/navigation

### Step 4: Check if the user is in a geofence, then change the UI

Call `Radar.trackOnce()` to track the user's location in the foreground. In the callback, check `user.geofences` to determine if the user is in a geofence, then display a modal to navigate the user to in store mode.

Additionally, the callback is used to get the store id, geofence external id, which is used to present information specific to the given store on the in store screen.

```javascript

import {useNavigation} from '@react-navigation/native';

export default HomeScreen = () => {
    const myNavigation = useNavigation();
    const [inStoreModalMessageVisible, setInStoreModalMessageVisible] = useState(false);
    const [storeId, setStoreId] = useState('');
  
    useEffect(() => {
      requestPermissions();
      inStoreModeLoader();
    }, []);
  
    const startInStoreMode = () => {
        myNavigation.navigate('inStoreMode', {storeId: storeId})
    }
  
    const inStoreModeLoader = async () => {
      Radar.trackOnce({"desiredAccuracy":"high"}).then(result => {
        if (result.status === "SUCCESS") {
          if (result.user?.geofences?.some(geofence => geofence.tag == "store")) {
            setInStoreModalMessageVisible(true);
            let storesDetected = result.user?.geofences?.filter(geofence => geofence.tag == "store")
            let storeIdDetected = storesDetected[0].externalId
            setStoreId(storeIdDetected)
          }
        }
      }).catch((err) => {
        console.log(err);
      });
    }

    return(
      <SafeAreaView style={backgroundStyle}>
       // other react elements to render
        <Modal visible={inStoreModalMessageVisible} transparent={true} animationType="slide">
          <View style={styles.centeredView}>
            <View style={styles.modalView}>
              <Text>Welcome to the store!</Text>
              <View>
                <Button
                  onPress={startInStoreMode}
                  title="Activate in store mode"
                  color="#841584"
                />
              </View>
            </View>
          </View>
        </Modal>
      </SafeAreaView>
    )
}
```

```javascript
export default InStoreScreen = ({route}) => {
  return (
    <SafeAreaView style={backgroundStyle}>
        // other react elements to render
        <View>
          <Text>Welcome to store #{route.params.storeId}</Text>
        </View>
    </SafeAreaView>
)};
```

### Step 5: Verify in store mode triggers when in a geofence.

Either simulate location on your phone or adjust the geofence location to your testing device's location. When you open the app, verify the in store mode triggers when in a geofence, but not when outside the geofence.  You should also see a user record appear on the Users page of the Radar dashboard with the detected geofences.

## Support

Have questions or feedback on this documentation? Let us know! Email us at [support@radar.com](mailto:support@radar.com).
