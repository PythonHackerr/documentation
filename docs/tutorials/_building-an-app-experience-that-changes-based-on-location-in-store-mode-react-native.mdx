## Features used

- [React Native SDK](/sdk/react-native)
- [Geofences](/geofences)

## Steps

### Step 1: Sign up for Radar

If you haven't already, sign up for Radar to get your API key. You can create up to 1,000 geofences and make up to 100,000 API requests per month for free.

<p> <a className="btn btn-large btn-primary" href="https://radar.com/signup">Get API Keys</a> </p>

### Step 2: Import geofences

On the [Geofences page](https://radar.com/dashboard), import geofences for RadarMart locations.

The CSV should include 8 columns:

- **`description`**: A display name for the geofence. In this case, the store name.
- **`tag`**: A group for the geofence. In this case, `store`.
- **`externalId`**: An external ID for the geofence that maps to your internal database. In this case, the store ID.
- **`type`**: The type of geofence geometry. In this case, `circle`.
- **`radius`**: The radius in meters for type circle. In this case, `100`.
- **`coordinates`**: A JSON string representing a center in the format [longitude,latitude] for type circle. Note that longitude comes before latitude, a GeoJSON convention.
- **`enabled`**: In this case, `true`.
- **`metadata`**: A set of custom key-value pairs for the geofence. A JSON string representing a dictionary with up to 16 keys and values of type string, boolean, or number. In this case, `{"parking": true}` or `{"parking": false}`.

```csv
description,tag,externalId,type,radius,coordinates,enabled,metadata
RadarMart #1,store,1,circle,100,"[-73.986752,40.703919]",true,"{""parking"":true}"
RadarMart #2,store,2,circle,100,"[-73.993156,40.700554]",true,"{""parking"":false}"
RadarMart #3,store,3,circle,100,"[-73.983295,40.697693]",true,"{""parking"":false}"
```

### Step 3: Install the Radar React Native SDK and React Navigation

Install the [Radar SDK](/sdk/react-native). Since only foreground location will be collected, the Radar SDK can be initialized in javascript rather than initializing the SDK in native code.

Additionally, this example will use React Navigation to direct the user to the in store mode if in store. Follow the [installation steps here](https://reactnative.dev/docs/navigation).

### Step 4: Create the home screen with an in store check

Add a new react component that will serve as your home screen. In this home screen, we will check for location permissions and request if not granted. If granted, we will check if the user is in store.

```javascript

import Radar from 'react-native-radar';
Radar.initialize("prj_test_pk...");

export default HomeScreen = () => {
  useEffect(() => {
    inStoreModeLoader();
  }, []);

  const inStoreModeLoader = () => {
    Radar.getPermissionsStatus().then((status) => {
      if (status === "GRANTED_FOREGROUND" || status === "GRANTED_BACKGROUND") {
        inStoreModalLoad()
      } else if (status === "NOT_DETERMINED") {
        Radar.requestPermissions(false).then((status) => {
          if (status === 'GRANTED_FOREGROUND') {
            inStoreModalLoad()
          }
        });
      }
    }).catch((err) => {
      console.log(err);
    });
  }

  return(
    <SafeAreaView style={backgroundStyle}>
      <StatusBar barStyle={'light-content'} />
      <ScrollView
        contentInsetAdjustmentBehavior="automatic"
        style={backgroundStyle}>
        {/* in store element to be added */}
      </ScrollView>
    </SafeAreaView>
  )
}
```

The `inStoreModalLoad` function checks if the app will let the user enter in store mode.

The method calls `Radar.trackOnce()` to capture the user's location in the foreground and returns user context including what geofences the user is detected to be in. In the callback, we check `user.geofences` to determine if the user is in a geofence and use the `geofences[*].externalId` to extract the detected store's Id.

We also set state variables to track if the in store check is still loading and if the user is eligible to enter in store mode.

```javascript
export default HomeScreen = () => {
  const [inStoreModalMessageVisible, setInStoreModalMessageVisible] = useState(false);
  const [storeId, setStoreId] = useState('');
  const [loading, setLoading] = useState(true);
  
  // existing logic

  const inStoreModalLoad = () => {
    Radar.trackOnce().then(result => {
      if (result.status === "SUCCESS") {
        inStoreModeCheck(result)
      } else {
        console.log(result.status)
      }
      setLoading(false);
    })
  }

  const inStoreModeCheck = (result) => {
    if (result.user?.geofences?.some(geofence => geofence.tag == "store")) {
      setInStoreModalMessageVisible(true);
      let storesDetected = result.user?.geofences?.filter(geofence => geofence.tag == "store")
      let storeIdDetected = storesDetected[0].externalId
      setStoreId(storeIdDetected)
    }
  }
}
```

Finally, the data returned from the `inStoreModalLoad` is used to conditionally allow the user to enter in store mode.

We leverage React Navigation to pass through the id of the store detected to our in store mode screen.

```javascript
import {useNavigation} from '@react-navigation/native';

export default HomeScreen = () => {
  const myNavigation = useNavigation();
  
  // existing code

  const startInStoreMode = () => {
      myNavigation.navigate('inStoreMode', {storeId: storeId})
  }

  const StoreExperience = () => {return (
    <View style={styles.centeredView}>
      <View style={modalStyle}>
        <Text style={styles.textStyle}>Welcome to the store!</Text>
        <View>
          <Button
            onPress={startInStoreMode}
            title="Activate in store mode"
            color="#841584"
          />
        </View>
      </View>
    </View>
  )}

  const StoreMessage = ({ message }) => {return (
    <View style={styles.centeredView}>
      <View style={modalStyle}>
        <Text style={styles.textStyle}>{message}</Text>
      </View>
    </View>
  )}

  return(
  <SafeAreaView style={backgroundStyle}>
    <StatusBar barStyle={'light-content'} />
    <ScrollView
      contentInsetAdjustmentBehavior="automatic"
      style={backgroundStyle}>
      {loading? null :
        <View>
          {inStoreModalMessageVisible? <StoreExperience /> : <StoreMessage message="In store mode not available." />}
        </View>
      }
    </ScrollView>
  </SafeAreaView>
)
}
```

### Step 5: Create the in store mode screen and navigation

Now that we have a home screen that checks whether or not the user is in store and conditionally renders a in store mode navigation option, we can build the in store mode screen.

We will take the store id passed through the navigation and surface it.

```javascript
export default InStoreScreen = ({route}) => {

  return (
    <SafeAreaView style={backgroundStyle}>
      <ScrollView
      contentInsetAdjustmentBehavior="automatic"
      style={backgroundStyle}>
        <View>
          <Text style={styles.sectionTitleDark}>Welcome to store #{route.params.storeId}</Text>
          {/* add additional in store features */}
        </View>
      </ScrollView>
    </SafeAreaView>
)};
```

We can now refactor our App entry point with a navigation container using the two screens we created.

```javascript

import {NavigationContainer} from '@react-navigation/native';
import {createNativeStackNavigator} from '@react-navigation/native-stack';

const Stack = createNativeStackNavigator();

import InStoreScreen from './InStoreScreen';
import HomeScreen from './HomeScreen';

const App: () => Node = () => {
  return (
    <NavigationContainer>
      <Stack.Navigator>
        <Stack.Screen
          name="Home"
          component={HomeScreen}
          options={{title: 'Radar Mart'}}
        />
        <Stack.Screen name="inStoreMode" component={InStoreScreen} options={{title: 'In Store Mode'}}/>
      </Stack.Navigator>
    </NavigationContainer>
  );
}
```

### Step 6: Verify in store mode triggers when in a geofence.

Either simulate location on your phone or adjust the geofence location to your testing device's location. When you open the app, verify the in store mode triggers when in a geofence, but not when outside the geofence.  You should also see a user record appear on the Users page of the Radar dashboard with the detected geofences.

![In Store Mode Verification](/gif/tutorials/in-store-mode/verify_in_store_mode_react_native.gif)

## Support

Have questions or feedback on this documentation? Let us know! Email us at [support@radar.com](mailto:support@radar.com).
